BX.namespace("BX.Catalog.SetConstructor");BX.Catalog.SetConstructor=function(){var t=function(t){this.numSliderItems=t.numSliderItems||0;this.jsId=t.jsId||"";this.ajaxPath=t.ajaxPath||"";this.currency=t.currency||"";this.lid=t.lid||"";this.iblockId=t.iblockId||"";this.basketUrl=t.basketUrl||"";this.setIds=t.setIds||null;this.offersCartProps=t.offersCartProps||null;this.itemsRatio=t.itemsRatio||null;this.noFotoSrc=t.noFotoSrc||"";this.mainElementPrice=Number(t.mainElementPrice)||0;this.mainElementOldPrice=Number(t.mainElementOldPrice)||0;this.mainElementDiffPrice=Number(t.mainElementDiffPrice)||0;this.parentCont=BX(t.parentContId)||null;this.sliderItemsCont=this.parentCont.querySelector("[data-role='set-other-items']");this.setItemsCont=this.parentCont.querySelector("[data-role='set-items']");this.setPriceCont=this.parentCont.querySelector("[data-role='set-price']");this.setOldPriceCont=this.parentCont.querySelector("[data-role='set-old-price']");this.setDiffPriceCont=this.parentCont.querySelector("[data-role='set-diff-price']");var e=this,a,i;var r=this.setItemsCont.querySelectorAll("[data-role='set-delete-btn']");if(r){for(a=0,i=r.length;a<i;a++){BX.bind(r[a],"click",function(){e.deleteFromSet(this.parentNode.parentNode)})}}var s=this.sliderItemsCont.querySelectorAll("[data-role='set-add-btn']");if(s){for(a=0,i=s.length;a<i;a++){BX.bind(s[a],"click",function(){e.addToSet(this.parentNode.parentNode.parentNode)})}}var d=this.parentCont.querySelector("[data-role='set-buy-btn']");BX.bind(d,"click",function(){e.addToBasket(this)});this.generateSliderStyles()};t.prototype.generateSliderStyles=function(){var t=BX.create("style",{html:".bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+this.numSliderItems*25+"%;}"+".bx-catalog-set-item-container-"+this.jsId+"{width: "+100/this.numSliderItems+"%;}"+"@media (max-width:767px){"+".bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+this.numSliderItems*20*2+"%;}}",attrs:{id:"bx-set-const-style-"+this.jsId}});if(BX("bx-set-const-style-"+this.jsId)){BX.remove(BX("bx-set-const-style-"+this.jsId))}this.parentCont.appendChild(t)};t.prototype.deleteFromSet=function(t){var e=t.getAttribute("data-id"),a=t.getAttribute("data-name"),i=t.getAttribute("data-url"),r=t.getAttribute("data-img"),s=t.getAttribute("data-print-price"),d=t.getAttribute("data-price"),c=t.getAttribute("data-print-old-price"),n=t.getAttribute("data-old-price"),l=t.getAttribute("data-diff-price"),o,m,h,p;h=this;p=BX.create("div",{attrs:{className:"bx-catalog-set-item-container bx-catalog-set-item-container-"+this.jsId,"data-id":e,"data-img":r?r:"","data-url":i,"data-name":a,"data-print-price":s,"data-print-old-price":c,"data-price":d,"data-old-price":n,"data-diff-price":l},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img-container"},children:[BX.create("img",{attrs:{src:r?r:this.noFotoSrc,className:"img-responsive"}})]})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-title"},children:[BX.create("a",{attrs:{href:i},html:a})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-price-new"},html:s}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price-old"},html:d!=n?c:""})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-add-btn"},children:[BX.create("a",{attrs:{className:"btn btn-add btn-sm"},html:BX.message("ADD_BUTTON"),events:{click:function(){h.addToSet(this.parentNode.parentNode.parentNode)}}})]})]})]});this.sliderItemsCont.appendChild(p);this.numSliderItems++;this.generateSliderStyles();BX.remove(t);for(o=0,m=this.setIds.length;o<m;o++){if(this.setIds[o]==e){this.setIds.splice(o,1)}}this.recountPrice()};t.prototype.addToSet=function(t){var e=t.getAttribute("data-id"),a=t.getAttribute("data-name"),i=t.getAttribute("data-url"),r=t.getAttribute("data-img"),s=t.getAttribute("data-print-price"),d=t.getAttribute("data-price"),c=t.getAttribute("data-print-old-price"),n=t.getAttribute("data-old-price"),l=t.getAttribute("data-diff-price");var o=this;var m=BX.create("tr",{attrs:{"data-id":e,"data-img":r?r:"","data-url":i,"data-name":a,"data-print-price":s,"data-print-old-price":c,"data-price":d,"data-old-price":n,"data-diff-price":l},children:[BX.create("td",{attrs:{className:"bx-added-item-table-cell-img"},children:[BX.create("img",{attrs:{src:r?r:this.noFotoSrc,className:"img-responsive"}})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-itemname"},children:[BX.create("a",{attrs:{href:i,className:"tdn"},html:a})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-price"},children:[BX.create("span",{attrs:{className:"bx-added-item-new-price"},html:s}),BX.create("br"),BX.create("span",{attrs:{className:"bx-added-item-old-price"},html:d!=n?c:""})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-del"},children:[BX.create("div",{attrs:{className:"bx-added-item-delete"},events:{click:function(){o.deleteFromSet(this.parentNode.parentNode)}}})]})]});this.setItemsCont.appendChild(m);this.numSliderItems--;this.generateSliderStyles();BX.remove(t);this.setIds.push(e);this.recountPrice()};t.prototype.recountPrice=function(){var t=this.mainElementPrice,e=this.mainElementOldPrice,a=this.mainElementDiffPrice;var i=BX.findChildren(this.setItemsCont,{tagName:"tr"},true);if(i){for(var r=0,s=i.length;r<s;r++){t+=Number(i[r].getAttribute("data-price"));e+=Number(i[r].getAttribute("data-old-price"));a+=Number(i[r].getAttribute("data-diff-price"))}}BX.ajax({method:"POST",dataType:"json",url:this.ajaxPath,data:{sessid:BX.bitrix_sessid(),action:"ajax_recount_prices",sumPrice:t,sumOldPrice:e,sumDiffDiscountPrice:a,currency:this.currency},onsuccess:BX.proxy(function(t){this.setPriceCont.innerHTML=t.formatSum?t.formatSum:"";this.setOldPriceCont.innerHTML=t.formatOldSum?t.formatOldSum:"";this.setDiffPriceCont.innerHTML=t.formatDiscDiffSum?t.formatDiscDiffSum:""},this)})};t.prototype.addToBasket=function(t){BX.showWait(t.parentNode);BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:this.setIds,lid:this.lid,iblockId:this.iblockId,setOffersCartProps:this.offersCartProps,itemsRatio:this.itemsRatio},BX.proxy(function(t){BX.closeWait();document.location.href=this.basketUrl},this))};return t}();
//# sourceMappingURL=script.map.js